# yaml-language-server: $schema=https://json.schemastore.org/github-workflow.json
---
name: Secrets Detection
run-name: Secrets Detection ${{ github.sha }} by @${{ github.actor }}

on:
  workflow_call:
    inputs:
      branch:
        description: "Branch (ref) to scan. Defaults to the ref that triggered the caller."
        required: false
        type: string

jobs:
  scan:
    name: Trufflehog
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: Get caller branch
        shell: bash
        run:
          | # see: https://github.com/trufflesecurity/trufflehog#shallow-cloning, adapted for workflow_call
          BRANCH="${INPUT_BRANCH:-$GITHUB_REF_NAME}"
          echo "branch=$BRANCH" >>"$GITHUB_ENV"
          echo "ðŸ”‘  Branch to scan : $BRANCH"
      - name: Checkout code
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # 5.0.0
        with:
          ref: ${{ env.branch }}
          fetch-depth: 0
      - name: Secret Scanning
        uses: trufflesecurity/trufflehog@ad6fc8fb446b8fafbf7ea8193d2d6bfd42f45690 # v3.90.11
        with:
          base: main
          head: ${{ env.branch }}
          extra_args: --results=verified
